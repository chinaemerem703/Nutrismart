<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NutriSmart Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body class="dashboard-body">

<!-- HEADER -->
<header class="header">
  <div class="logo">
    <img src="images/landing-page-logo-image.png" alt="NutriSmart" width="30">
    <span>Nutri<span class="span-b">Smart</span> </span>
  </div>
 <div class="user-actions">
    <a href="settings.html"><button class="btn-profile">Profile</button></a>
    <button class="btn-logout" onclick="showLogoutModal()">Log out</button>
</div>

<div id="logoutModal" class="modal-overlay">
    <div class="modal-content">
        <h3>confirm Logout</h3>
        <p>Are you sure you want to log out? You need to sign in again to access your account.</p>
        <div class="modal-buttons">
            <button class="btn-confirm" onclick="confirmLogout()">Log Out</button>
            <button class="btn-cancel" onclick="hideLogoutModal()">Cancel</button>
        </div>
    </div>
</div>
</header>

<div class="container">

  <!-- USER GREETING -->
  <div class="greeting">
    <img src="images/Frame 12.png" alt="User" class="avatar">
    <h1>Hello, <span id="userName">User</span>!</h1>
  </div>

  <!-- STATS CARDS -->
  <div class="stats-grid">
    <div class="stat-card">
      <p>Daily Goal</p>
      <h3>2000 kcal</h3>
      <span class="icon"><img src="images/Container.png" alt=""></span>
    </div>
    <div class="stat-card">
      <p>Foods Tracked</p>
      <h3>12 today</h3>
      <span class="icon"><img src="images/Container (1).png" alt=""></span>
    </div>
    <div class="stat-card">
      <p>Streak</p>
      <h3>7 days</h3>
      <span class="icon"><img src="images/Container (2).png" alt=""></span>
    </div>
    <div class="stat-card">
      <p>Health Score</p>
      <h3>85/100</h3>
      <span class="icon"><img src="images/Container (3).png" alt=""></span>
    </div>
  </div>

  <!-- RECOMMENDED MEALS -->
  <section class="section">
    <h2>Recommended for You</h2>
    <p class="subtitle">Based on your health profile and goals</p>

    <div class="meal-card">
      <img src="images/image 5.png" alt="Jollof Rice">
      <div className="meal-info">
        <h4>Jollof Rice with Chicken</h4>
        <p>560 kcal • Protein-rich meal with moderate energy release</p>
      </div>
      <button class="btn-add">suitable</button>
    </div>

    <div class="meal-card">
      <img src="images/Rectangle 47.png" alt="Ugali">
      <div className="meal-info">
        <h4>Ugali with Vegetables</h4>
        <p>130 kcal • Low in fat and rich in fiber from vegetables</p>
      </div>
      <button class="btn-add">suitable</button>
    </div>

    <div class="meal-card">
      <img src="images/Rectangle 46.png" alt="Oranges">
      <div className="meal-info">
        <h4>Oranges</h4>
        <p>62 kcal • Low in calories, high in vitamin C</p>
      </div>
      <button class="btn-add">suitable</button>
    </div>

 <a href="suggest.html"><button class="btn-suggestions"> View more meal suggestions</button></a>
  </section>

  <!-- TODAY'S TIPS -->
  <section class="section">
    <h2>Today's Tips</h2>
    <ul class="tips-list">
      <li>Drink at least 8 glasses of water today</li>
      <li>Include leafy greens in your meals</li>
      <li>Take a 15-minute walk after meals</li>
    </ul>
    <a href="nutrition.html" class="view-all">View All Tips</a>
  </section>

  <!-- QUICK ACTIONS -->
  <section class="section">
    <h2>Quick Actions</h2>
    <div class="quick-actions">
      <a href="library.html" class="action-item"> <img src="images/Icon.png" alt="" > Browse Foods</a>
      <a href="progress-tracker.html" class="action-item"> <img src="images/Icon (1).png" alt=""> View Progress</a>
      <a href="nutrition.html" class="action-item"> <img src="images/Icon (2).png" alt=""> Nutrition Tips</a>
    </div>
  </section>

</div>

  </div>

  <script>
 if (!localStorage.getItem("authToken")) {
    window.location.href = "login.html";
  }

  
  function getToken() {
    return localStorage.getItem("authToken");
  }

  
  function loadUserName() {
    const savedUser = localStorage.getItem('user');
    if (savedUser) {
      const user = JSON.parse(savedUser);
      document.getElementById('userName').textContent = user.name || "User";
    } else {
    
      fetch("https://nutri-smart-akeg.onrender.com/profile/get", {
        headers: { Authorization: `Bearer ${getToken()}` }
      })
      .then(res => res.json())
      .then(data => {
        if (data.name) {
          document.getElementById('userName').textContent = data.name;
          localStorage.setItem('user', JSON.stringify({ name: data.name }));
        }
      })
      .catch(() => {});
    }
  }

  
  async function loadRecommendations() {
    const token = getToken();
    if (!token) return (window.location.href = "login.html");

    try {
      const response = await fetch(
        "https://nutri-smart-akeg.onrender.com/recommend",
        {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        }
      );

      const result = await response.json();

      if (response.ok && result.recommendations) {
        displayMeals(result.recommendations);
      } else {
        document.getElementById("meals-container").innerHTML = 
          `<p style="color:#999; text-align:center;">No recommendations yet. Complete your profile!</p>`;
      }
    } catch (error) {
      console.error("Fetch error:", error);
      document.getElementById("meals-container").innerHTML = 
        `<p style="color:#d32f2f; text-align:center;">Failed to load meals.</p>`;
    }
  }

  
  function displayMeals(meals) {
    const container = document.getElementById("meals-container");
    container.innerHTML = "";

    if (!meals || meals.length === 0) {
      container.innerHTML = `<p style="color:#999; text-align:center;">No meals found.</p>`;
      return;
    }

    meals.forEach((meal) => {
      const div = document.createElement("div");
      div.className = "meal-card";
      div.innerHTML = `
        <img src="images/image 5.png" alt="${meal.meal}">
        <div class="meal-info">
          <h4>${meal.meal}</h4>
          <p>${meal.calories || 'N/A'} kcal • ${meal.benefits || 'Healthy choice'}</p>
        </div>
        <button class="btn-add">suitable</button>
      `;
      container.appendChild(div);
    });
  }

  // === LOGOUT MODAL ===
  function showLogoutModal() {
    document.getElementById('logoutModal').style.display = 'flex';
  }

  function hideLogoutModal() {
    document.getElementById('logoutModal').style.display = 'none';
  }

  function confirmLogout() {
    hideLogoutModal();
    localStorage.removeItem("authToken");
    localStorage.removeItem("user");
    window.location.href = "login.html";
  }

  // === INIT ON LOAD ===
  document.addEventListener("DOMContentLoaded", () => {
    loadUserName();
    loadRecommendations();
  });
</script>
</body>
</html>

</body>
</html>